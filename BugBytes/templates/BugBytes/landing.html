{% extends "base.html" %} {% load static %} {% block content %}
<div class="header">
    <h1>BugBytes</h1>
</div>

<div class="container">
    <div class="dragandid">
        <div class="upload">
            <div class="dropzone" id="myDropzone"></div>
            <div class="row">
                <div class="input_box">
                    <label for="">
                <!-- <input type="file" id="myFile" size="50" onchange="uploadImage(event)"> -->
                </label>
                </div>
            </div>
        </div>

        <div class="identify">
            <button class="identify"><a href="{% url 'view_species' tensorflow_id=2 %}">Identify!</a></button>
        </div>
    </div>

    <div class="blurb">
        <p>This is where the Main Purpose blurb will go</p>
    </div>


</div>

<!-- <div class="species_pics">
    <div><img class="species_pics" src="https://images-na.ssl-images-amazon.com/images/I/21y1sp0r0aL.jpg" alt="Achecta domesticus">Achecta domesticus</div>
    <div><img class="species_pics" src="https://bugguide.net/images/raw/VHP/HLR/VHPHLR6HJH6HBHGH1HPH3HXHDH8HBH6HAHRL9Z4L3H5L9ZILWZ4LHRGHVHMHOH0L4ZSL1H7HOHWH.jpg" alt="Conocephalus Brevipennis">Conocephalus brevipennis</div>
    <div><img class="species_pics" src="https://i.ytimg.com/vi/Gj5eQDqhXL0/hqdefault.jpg" alt="Dissosteira carolina">Dissosteira carolina</div>
    <div><img class="species_pics" src="https://bugguide.net/images/cache/MLW/Z4L/MLWZ4L9ZSLFH5HVH8HZR6H3HPH1H5HDH4HBHMHAHSLCHXHTHIHOHRLOHLLCHXH1H7H1H5H5ZQL2ZXHAHMHTH7HBH5H.jpg" alt="Melanoplus bivittatus">Melanoplus bivittatus</div>
    <div><img class="species_pics" src="https://idtools.org/id/grasshoppers/images/fs_images/M_differentialis_female2_o.jpg" alt="Melanoplus differentialis">Melanoplus differentialis</div>
    <div><img class="species_pics" src="https://idtools.org/id/grasshoppers/images/fs_images/M_femurrubrum_female_o.jpg" alt="Melanoplus femurrubrum">Melanoplus femurrubrum</div>
    <div><img class="species_pics" src="https://bugguide.net/images/cache/TLI/ZAL/TLIZAL7Z6L6ROZ8RLHKRCZ0ROZKROZ8RLH4RVL7ZKHIRTZZZOLIZOL8RALKZDLKZOLKZAL6R3ZFLPLIRDZSR6LZZ3ZMR.jpg" alt="Melanoplus punctulatus">Melanoplus punctulatus</div>
    <div><img class="species_pics" src="https://bugguide.net/images/cache/JKW/RRQ/JKWRRQ9R7QDQN0K0903Q70H020H0P0CRIQL0E0L0IQTR60K0P0DRE0S090TR20H0W0FR60TRMQR0MQCRKQORKQCRU0.jpg" alt="Microcentrum rhombifolium">Microcentrum rhombifolium</div>
    <div><img class="species_pics" src="https://bugguide.net/images/cache/LH5/R0H/LH5R0H4R3Z0ZWLMZALMZNLHZ9LRZ9L7R2L0RTZ3L2LXROZIR3ZSRHHXZULFLCZQRWLMZSHXRPLRZDLIZDLXZOLSZ6LJL.jpg" alt="Neocurtilla hexadactyla">Neocurtilla hexadactyla</div>
    <div><img class="species_pics" src="http://songsofinsects.com/wp-content/uploads/insect_musicians_neox-punct_LE_DIGI.jpg" alt="Neoxabea bipunctata">Neoxabea bipunctata</div>
    <div><img class="species_pics" src="https://bugguide.net/images/cache/VLK/ZCL/VLKZCLSZ9LGRJZIROZ8RHHERSH6RAL7ZQHGRTLLZOL5RSHERBLGRTLQZCLSZLH4RZHSZTLSZQHIZBL0ZSHPR0HSZVLKZ.jpg" alt="Phyllopalpus pulchellus">Phyllopalpus pulchellus</div>
    <div><img class="species_pics" src="https://bugguide.net/images/raw/LZ6/LYL/LZ6LYL9LHZNLRZELMROZFLBLSZLH2RSHPR0HERJZRZELLZNL7R9LXZRH8ROL7Z9LFLEL7R6LXRWLHZ.jpg" alt="Romalea microptera">Romalea microptera</div>
</div> -->


<script src="{% static 'dropzone.js' %}"></script>
<script src="https://unpkg.com/cropperjs"></script>

<script>
    Dropzone.options.myDropzone = {
        url: '/post',
        transformFile: function(file, done) {

            // Create Dropzone reference for use in confirm button click handler
            var myDropZone = this;

            // Create the image editor overlay
            var editor = document.createElement('div');
            editor.setAttribute('id', 'insectPic')
            editor.style.position = 'fixed';
            editor.style.left = 0;
            editor.style.right = 0;
            editor.style.top = 0;
            editor.style.bottom = 0;
            editor.style.zIndex = 9999;
            editor.style.backgroundColor = '#000';
            document.body.appendChild(editor);

            // Create confirm button at the top left of the viewport
            var buttonConfirm = document.createElement('button');
            buttonConfirm.style.position = 'absolute';
            buttonConfirm.style.left = '10px';
            buttonConfirm.style.top = '10px';
            buttonConfirm.style.zIndex = 9999;
            buttonConfirm.textContent = 'Confirm';
            editor.appendChild(buttonConfirm);
            buttonConfirm.addEventListener('click', function() {
                // Get the canvas with image data from Cropper.js
                var canvas = cropper.getCroppedCanvas({
                    width: 256,
                    height: 256
                });
                // Turn the canvas into a Blob (file object without a name)
                canvas.toBlob(function(blob) {

                    // Create a new Dropzone file thumbnail
                    myDropZone.createThumbnail(
                        blob,
                        myDropZone.options.thumbnailWidth,
                        myDropZone.options.thumbnailHeight,
                        myDropZone.options.thumbnailMethod,
                        false,
                        function(dataURL) {

                            // Update the Dropzone file thumbnail
                            myDropZone.emit('thumbnail', file, dataURL);
                            // Return the file to Dropzone
                            done(blob);

                            var images = [];
                            myDropZone.getQueuedFiles().forEach(function(file) {
                                let image = {
                                    dataURL: file.dataURL,
                                    name: file.name,
                                    type: file.type,
                                    size: file.size,
                                };
                                images.push(image);
                            });
                            sessionStorage.setItem("images", JSON.stringify(images));

                            var images = JSON.parse(sessionStorage.getItem('images'));
                            images.forEach(function(image) {
                                dropzone.files.push(image);
                                dropzone.emit("addedfile", image);
                                dropzone.emit("thumbnail", image, image.dataURL);
                                dropzone.emit("complete", image);
                            });
                            myDropZone.options.maxFiles = myDropZone.options.maxFiles - images.length;
                            console.log(sessionStorage)
                        });
                    done(blob);
                });

                // Remove the editor from the view
                document.body.removeChild(editor);
            });

            // Create an image node for Cropper.js
            var image = new Image();
            image.src = URL.createObjectURL(file);
            editor.appendChild(image);

            // Create Cropper.js
            var cropper = new Cropper(image, {
                aspectRatio: 1
            });
        }
    };
</script>

{% endblock %}